<div class="app-container">
  <!-- Header Bar -->
  <div class="header-bar">
    <button class="menu-btn" *ngIf="user?.logged_in">
      <span class="menu-icon">‚ò∞</span>
      <span class="badge" *ngIf="taskResponse">2</span>
    </button>
    <h1 class="app-title">Banana Assistant</h1>
    <button class="close-btn" *ngIf="user?.logged_in" (click)="logout()">‚úï</button>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Login State -->
    <ng-container *ngIf="!user?.logged_in">
      <div class="welcome-section">
        <div class="sparkle-icon">‚ú®</div>
        <h2 class="welcome-title">Welcome to <span class="highlight">Banana Assistant</span></h2>
        <p class="welcome-subtitle">Sign in to get started</p>
      </div>
      
      <div class="action-buttons">
        <button class="option-btn login" (click)="login()">
          <span class="option-title">üîê Sign in with Microsoft</span>
          <span class="option-desc">Access your Azure DevOps tasks</span>
        </button>
      </div>
    </ng-container>

    <!-- Logged In - Welcome Menu -->
    <ng-container *ngIf="user?.logged_in && !activeView">
      <div class="welcome-section">
        <div class="sparkle-icon">‚ú®</div>
        <h2 class="welcome-title">Welcome to <span class="highlight">Banana Assistant</span></h2>
        <p class="welcome-subtitle">What would you like to check?</p>
      </div>
      
      <div class="action-buttons">
        <button class="option-btn" (click)="showTodayTasks()">
          <span class="option-title">Today's Tasks</span>
          <span class="option-desc">See what you need to do today</span>
        </button>
        
        <button class="option-btn" (click)="showLastWeekTasks()">
          <span class="option-title">Last Week's Tasks</span>
          <span class="option-desc">Review your recent progress</span>
        </button>
        
        <button class="option-btn" (click)="showLeavePlan()">
          <span class="option-title">Leave Plan</span>
          <span class="option-desc">Check if you can take a day off</span>
        </button>
      </div>
    </ng-container>

    <!-- Task View -->
    <ng-container *ngIf="user?.logged_in && activeView">
      <div class="view-header">
        <button class="back-btn" (click)="goBack()">‚Üê Back</button>
        <h3 class="view-title">{{ getViewTitle() }}</h3>
      </div>

      <!-- Tabs for Today's Tasks -->
      <div class="tabs" *ngIf="activeView === 'today' && taskResponse && !isLoading">
        <button class="tab" [class.active]="activeTab === 'active'" (click)="activeTab = 'active'">
          üìä Active
        </button>
        <button class="tab" [class.active]="activeTab === 'pullreq'" (click)="activeTab = 'pullreq'">
          üîÄ PR
        </button>
        <button class="tab" [class.active]="activeTab === 'changes'" (click)="activeTab = 'changes'">
          üìÖ Changes
        </button>
      </div>

      <!-- Result Section -->
      <div class="result-section">
        <!-- Loading -->
        <div *ngIf="isLoading" class="placeholder">
          <div class="loading-spinner"></div>
          <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
        </div>

        <!-- Error -->
        <div *ngIf="error" class="placeholder error">
          <div class="icon">‚ùå</div>
          <p>{{ error }}</p>
        </div>

        <!-- No tasks yet -->
        <div *ngIf="!isLoading && !taskResponse && !error && activeView !== 'leave'" class="placeholder">
          <div class="icon">üìÇ</div>
          <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <!-- Task Content -->
        <div *ngIf="taskResponse && !isLoading && activeView !== 'leave'" class="task-content">
          <div [innerHTML]="getTabContent()"></div>
        </div>

        <!-- Leave Plan Content -->
        <div *ngIf="activeView === 'leave' && !isLoading" class="leave-content">
          <div class="leave-card available">
            <div class="leave-icon">‚úÖ</div>
            <h4>You can take a day off!</h4>
            <p>Based on your current workload, tomorrow looks good for leave.</p>
          </div>
          <div class="leave-stats">
            <div class="stat-item">
              <span class="stat-value">5</span>
              <span class="stat-label">Days remaining</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">2</span>
              <span class="stat-label">Pending tasks</span>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- User Info Footer -->
  <div class="user-footer" *ngIf="user?.logged_in">
    <div class="user-avatar">{{ user?.name?.charAt(0) || '?' }}</div>
    <div class="user-info">
      <span class="user-name">{{ user?.name }}</span>
      <span class="user-email">{{ user?.email }}</span>
    </div>
  </div>
</div>
